# Chrome 倒计时插件需求文档

## 1. 项目概述

开发一个 Chrome 浏览器扩展，提供标签页倒计时功能。用户可以设置特定的时间，插件会进行倒计时并在浏览器工具栏显示剩余时间。插件支持保存多个自定义定时器，便于用户快速启动常用的倒计时设置。

## 2. 功能需求

### 2.1 基础功能

- 用户可设置倒计时的小时、分钟、秒
- 启动倒计时后在浏览器工具栏图标显示剩余时间
- 倒计时过程中可随时取消
- 倒计时结束时发出通知提醒用户

### 2.2 自定义定时器功能

- 用户可以创建、编辑和删除多个自定义定时器
- 每个定时器可设置时间（小时、分钟、秒）
- 定时器可配置不同的提醒声音
- 定时器可设置不同的颜色标识
- 插件打开时显示已保存的定时器列表
- 用户可以一键启动列表中的任意定时器
- 支持拖拽排序定时器列表

### 2.3 界面需求

- 插件包含两个主要界面：
  1. **定时器列表界面**：显示所有保存的定时器，支持快速启动、排序
  2. **创建/编辑定时器界面**：用于新建或修改定时器设置
- 弹出窗口默认显示"定时器列表界面"，标题为"New Countdown Timer"
- 定时器列表界面包含新增定时器按钮和已保存的定时器列表
- 每个定时器项显示时间、颜色标识和快速启动按钮
- 创建/编辑界面提供时间设置（小时、分钟、秒）、颜色选择、声音选择
- 插件图标在倒计时时动态显示剩余时间
- 界面设计符合 Material Design 风格

### 2.4 交互需求

- 点击扩展图标打开定时器列表界面
- 点击列表中的"新建"按钮或编辑按钮跳转到创建/编辑界面
- 在创建/编辑界面完成设置后可保存或取消返回列表界面
- 列表界面支持拖拽排序定时器顺序
- 点击定时器列表项中的启动按钮快速启动对应定时器
- 输入框应支持键盘输入和数字增减
- 倒计时过程中图标应每秒更新一次
- 倒计时结束时发出桌面通知及选定的声音提醒
- **当有进行中的倒计时时，界面只展示倒计时，不展示定时器列表，倒计时结束后再恢复展示定时器列表**

## 3. 技术规格

### 3.1 架构设计

- 符合 Chrome 扩展 Manifest V3 规范
- 使用 Service Worker 作为后台脚本
- 前端使用 react/tailwindcss/TypeScript 实现
- 采用模块化设计，分离 UI 和业务逻辑
- 采用状态管理模式处理两个界面间的数据流转

### 3.2 核心模块

- **弹出界面(Popup)**: 包含定时器列表和创建/编辑定时器两个主要视图
- **背景服务(Background)**: 管理倒计时逻辑和存储
- **图标管理(Icon)**: 动态更新工具栏图标显示
- **定时器管理(TimerManager)**: 管理自定义定时器的创建、存储和使用
- **声音管理(SoundManager)**: 处理不同定时器声音的选择和播放
- **路由管理(RouteManager)**: 处理两个主要界面的切换和状态保持

### 3.3 数据存储

- 使用 chrome.storage.local 存储倒计时设置和状态
- 保存上次设置的时间值，提高用户体验
- 保存用户创建的定时器列表，包含时间、颜色和声音配置
- 存储定时器列表的排序顺序
- 记录当前正在编辑的定时器状态，支持界面切换时保持数据

### 3.4 通信机制

- 使用 chrome.runtime.sendMessage 实现组件间通信
- Background 与 Popup 之间保持状态同步
- 两个主要界面之间采用状态共享机制进行数据传递

## 4. 开发规范

### 4.1 文件结构

```
├── public/
│   ├── manifest.json
│   ├── icons/
│   │   ├── icon16.png
│   │   ├── icon48.png
│   │   └── icon128.png
│   ├── sounds/
│   │   ├── default.mp3
│   │   ├── bell.mp3
│   │   ├── chime.mp3
│   │   └── alarm.mp3
├── src/
│   ├── popup/
│   │   ├── popup.html
│   │   ├── popup.tsx
│   │   ├── popup.css
│   │   ├── pages/
│   │   │   ├── TimerListPage.tsx
│   │   │   └── TimerEditPage.tsx
│   │   ├── components/
│   │   │   ├── TimerForm.tsx
│   │   │   ├── TimerList.tsx
│   │   │   ├── TimerItem.tsx
│   │   │   ├── ColorPicker.tsx
│   │   │   ├── SoundSelector.tsx
│   │   │   └── Navigation.tsx
│   ├── background/
│   │   └── service-worker.ts
│   ├── utils/
│   │   ├── timer.ts
│   │   ├── storage.ts
│   │   ├── icon-generator.ts
│   │   ├── sound-manager.ts
│   │   ├── color-utils.ts
│   │   └── route-manager.ts
│   ├── contexts/
│   │   └── TimerContext.tsx
│   └── types/
│       └── index.ts
├── package.json
├── tsconfig.json
└── webpack.config.js
```

### 4.2 代码规范

- 使用 TypeScript 强类型
- 遵循函数式编程模式
- 使用 ESLint 和 Prettier 保证代码质量
- 添加适当的注释和文档
- 使用 React Context API 或 Redux 进行状态管理

## 5. 实现步骤

### 5.1 初始环境搭建

1. 创建项目基础结构
2. 配置 TypeScript 和 Vite
3. 设置基础 manifest.json
4. 配置路由系统处理多界面

### 5.2 功能开发顺序

1. 实现基本路由系统，支持两个主要界面切换
2. 开发定时器列表界面基础结构
3. 开发创建/编辑定时器界面
4. 实现定时器存储和管理功能
5. 添加拖拽排序功能
6. 开发计时器核心逻辑
7. 实现工具栏图标动态更新
8. 添加声音和颜色自定义功能
9. 添加通知功能
10. 完善设置保存和状态同步

### 5.3 测试策略

1. 单元测试各功能模块
2. 界面导航测试确保切换正常
3. 集成测试确保组件协同工作
4. 用户界面测试
5. 浏览器兼容性测试

## 6. 性能与安全考虑

### 6.1 性能优化

- 最小化后台脚本资源占用
- 使用 requestAnimationFrame 优化图标更新
- 合理设置检查间隔减少 CPU 占用
- 优化定时器列表渲染，避免不必要的重绘
- 实现高效的界面切换机制，减少资源消耗

### 6.2 安全措施

- 实施内容安全策略(CSP)
- 权限最小化原则
- 安全处理用户输入
- 安全存储用户自定义设置

## 7. 发布计划

### 7.1 打包与部署

- 使用 vite 生成生产环境构建
- 准备 Chrome Web Store 所需资源
